name: PRs

on:
    pull_request:
        types: [opened, synchronize, labeled]

jobs:
    renovate:
        name: 🔍 Update lockfile
        runs-on: ubuntu-latest
        if: contains(github.event.pull_request.labels.*.name, 'Dependency')

        permissions:
            contents: write
            pull-requests: write

        steps:
            - name: 🕶️ Checkout repository
              uses: actions/checkout@v4
              with:
                  fetch-depth: 0
                  ref: ${{github.event.pull_request.head.ref}}
                  repository: ${{github.event.pull_request.head.repo.full_name}}
                  token: ${{ secrets.MACHINE_USER }}

            - name: 📦 Pull from remote
              run: git pull

            - name: 🚀 Bootstrap
              uses: ./.github/common/bootstrap

            - name: 📦 Commit lockfile
              run: |
                  git config user.name 'github-actions[bot]'
                  git config user.email 'github-actions[bot]@users.noreply.github.com'
                  git commit -a -m "Deps: Update lockfile." --no-verify

            - name: 🚀 Push changes
              uses: ad-m/github-push-action@master
              with:
                  branch: ${{ github.head_ref }}
                  github_token: ${{ secrets.MACHINE_USER }}
